
#set($rootcategory = $categoryPickerTree.getModel().getRoot())

#macro(showtreecategories $cat $depth) 
		#set ( $padding = (20 * $depth) )
		#set($children = $cat.getChildren())
		#set( $haschildren = $cat.hasChildren())
		#set( $open = $haschildren)
		#set( $checked = false )
		#set( $expanded = $categoryPickerTree.isExpanded($cat) )
		#set( $checked = $asset.isInCategory($cat))
		<li class="noderow" id="${cat.id}_row" data-nodeid="$cat.id" data-depth="$depth">
			<div style="padding-left: ${padding}px">
				#if($haschildren)<span class="arrow #if($expanded) down #end "></span>#end 
				<span id="${cat.id}_display" class="name folder #if($haschildren) leaf #end">$cat.name</span>
				<span id="${cat.id}_edit" class="name folder" style="display:none;">
					<input class="field" type="text" value="$cat.name" id="${cat.id}_edit_field" />
					<a class="editsave btn">Save</a>
					<a id="${cat.id}" class="editcancel btn">Cancel</a>
				</span>
				<span class="actions">
					<a class="edit ir tooltip" title="Edit Category Name">Edit</a>
					<a class="add ir tooltip" title="Add a new Category" id="$cat.id">Add New</a>
					<a data-parent="${cat.id}" class="delete ir tooltip" title="Delete Category">Delete</a>
				</span>
			</div>
		#if($haschildren && $expanded)
		   <ul class="open" >
			#set ( $depth = $depth + 1)
			#foreach( $category in $children)
				  #showtreecategories($category, $depth)
		    #end
		   </ul>
		#end
		</li>
		<li id="${cat.id}_add" style="display: none;"><div class="selected new"><span class="name folder"><input class="field" type="text" value="New Category" id="${cat.id}_new" /><a data-parent="${cat.id}" class="save btn">Save</a><a id="${cat.id}" class="cancel btn">Cancel</a></span></div></li>		 	
		
#end
#set( $toggle = $context.getRequestParameter("toggle" ) )
#if( $toggle && $toggle == "true" )
	#set( $nodeid = $context.getRequestParameter("nodeID" ) )
	#set( $target = $categoryPickerTree.getModel().getChildById($nodeid) )

	$!categoryPickerTree.getTreeRenderer().toggleNode($target)

	#set( $depths = $context.getRequestParameter("depth" ) )
	#set( $depth = 0 )
	#set( $depth = $depth.parseInt($depths) )
	#showtreecategories($target, $depth)
#else
<div id="treeholder" class="ui-widget" >
	<div  class="ui-widget-header">Categories</div>
	<div  class="ui-widget-content categories-widget no-padding-for-real of-visible">
		<div id="attachments-container">
			<div class="emtree attachments" data-home="$home$apphome">
					<ul  class="open" >
					#showtreecategories($rootcategory, 0)
					</ul>
			</div>
		</div>
	</div>
</div>
#end
