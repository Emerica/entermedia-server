#set( $rootpath = "${apphome}/components/categorize")
<div id="addcategory">
	#set ($existing = $context.getRequestParameter("category.values") )
	#if( $existing && !$existing.trim().isEmpty() )
	    <ul id="cat-list">
		#foreach($categoryid in $existing.replace("  ","").trim().split(" +"))
			#set($category  = $mediaarchive.getCategory($categoryid))
			<li class="row categorydraggable ui-draggable ui-draggable-handle collectionBox" data-nodeid="$categoryid" data-categoryname="$category.getName()">
				<a class="category ajax" title="$category.getCategoryPath()" targetdivinner="view-picker-content" href="$home$apphome/views/categories/${category.id}.html?oemaxlevel=2" >$category.getName()</a>
				<div class="collectionIcons">
						<a href="#" title="[[Remove]]">
							<span class="closecollection ui-icon ui-icon-closethick " data-categoryid="$categoryid"></span>
						</a>
				</div>
			</li>
		#end
		</ul>
	#end
   <input type="hidden" name="operation" value="orsgroup" />
   	<input type="hidden" id="categoryvalues" name="category.values" value="$!existing" />
   
   <a class="emdialog btn small" href="$home$apphome/components/categories/searchcategory.html?targetdiv=addcategory&clearselection=$!clear&action=$page.path" data-hidefooter="true" data-parameterdata="categoryvalues">[[Pick Categories]]</a>

<script>

	$("#cat-list .closecollection").on("click",function() 
			{
				var link = $(this);
				link.closest("li").hide();
				
				var id = link.data("categoryid");
				var existing = $("#categoryvalues").val();
				existing = existing.replace(id,"");
				existing = existing.replace("  "," ");
				$("#categoryvalues").val(existing);
				
				
			}
	);

</script>
</div>
