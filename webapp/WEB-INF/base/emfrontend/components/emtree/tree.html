#set($treename = $context.getRequestParameter("tree-name") )
#set($webtree = $context.getPageValue($treename) )

#set( $showinput = $webtree.getTreeRenderer().isAllowSelections() )
#set( $editable = $webtree.getTreeRenderer().isEditable() )
#set( $model = $webtree.getModel() )
#set( $render = $webtree.getTreeRenderer() )

#macro(showtreecategories $cat $depth) 
		#set ( $padding = (20 * $depth) )
		#set($children = $cat.getChildren())
		#set( $haschildren = $cat.hasChildren())
		#set( $open = $haschildren)
		#set( $checked = false )
		#set( $expanded = $webtree.isExpanded($cat) )
		#set( $checked = $asset.isInCategory($cat))
		<li class="noderow" id="${cat.id}_row" data-nodeid="$cat.id" data-depth="$depth">
			<div style="padding-left: ${padding}px">#if( $showinput )<input name="categoryid" class="field" value="$cat.id" type="checkbox" #if( $render.isIdSelected($cat.id) ) checked="true" #end  >#end
				#if($haschildren)<span class="arrow #if($expanded) down #end "></span>#end 
				<span id="${cat.id}_display" class="name folder #if($haschildren) leaf #end">$cat.name</span>
				<span id="${cat.id}_edit" class="name folder" style="display:none;">
					<input class="field" type="text" value="$cat.name" id="${cat.id}_edit_field" />
					<a class="editsave btn">Save</a>
					<a id="${cat.id}" class="editcancel btn">Cancel</a>
				</span>
				#if( $editable )
				<span class="actions">
					<a class="edit ir tooltip" title="Edit Category Name">Edit</a>
					<a class="add ir tooltip" title="Add a new Category" id="$cat.id">Add New</a>
					<a data-parent="${cat.id}" class="delete ir tooltip" title="Delete Category">Delete</a>
				</span>
				#end
			</div>
		#if($haschildren && $expanded)
		   <ul class="open" >
			#set ( $depth = $depth + 1)
			#foreach( $category in $children)
				  #showtreecategories($category, $depth)
		    #end
		   </ul>
		#end
		</li>
		<li id="${cat.id}_add" style="display: none;"><div class="selected new"><span class="name folder"><input class="field text" type="text" value="New Category" id="${cat.id}_new" /><a data-parent="${cat.id}" class="save btn">Save</a><a id="${cat.id}" class="cancel btn">Cancel</a></span></div></li>		 	
		
#end
#set( $toggle = $context.getRequestParameter("toggle" ) )
#if( $toggle && $toggle == "true" )
	#set( $nodeid = $context.getRequestParameter("nodeID" ) )
	#set( $target = $webtree.getModel().getChildById($nodeid) )

	$!webtree.getTreeRenderer().toggleNode($target)

	#set( $depths = $context.getRequestParameter("depth" ) )
	#set( $depth = 0 )
	#set( $depth = $depth.parseInt($depths) )
	#showtreecategories($target, $depth)
#else

#set($rootcategory = $webtree.getModel().getRoot())

<div id="treeholder" >
	<div class="emtree" data-home="$home$apphome" data-treename="$treename" data-editable="$editable" data-url-prefix="$!render.getUrlPrefix()" data-url-postfix="$!render.getUrlPostfix()">
			<ul  class="open" >
			#showtreecategories($rootcategory, 1)
			</ul>
	</div>
</div>
#end
