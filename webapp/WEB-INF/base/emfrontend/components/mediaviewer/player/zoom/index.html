#set( $page = $context.getRequestParameter("pagenum") )
#set( $name = $context.getRequestParameter("name") )

#set ( $urlutils = $context.getPageValue("url_util"))
#if (!$urlutils)
	#set ($urlenc = $asset.sourcepath)
#else
	#set ( $urlenc = $urlutils.encode($asset.sourcepath))
	#set ( $urlenc = $urlenc.replace("%2F", "/") )
#end

<div id="mainholder">
<img id="mainimage" src="$home/${applicationid}/views/modules/asset/downloads/preview/extralarge/$urlenc/${name}?pagenum=$!page" />
</div>

<style>

#mainholder
{
	position: relative;
	height:100%;
	width:100%;
	overflow: hidden;
}

#mainimage
{
	position: absolute;
	top: -10px;
	left: 50px;
}

.fancybox-inner {
    overflow: hidden !important;
  }

</style>

<script>

jQuery(document).ready(function() 
{ 
	var zoom = 40;
	
	$("#mainholder").height($(window).height());
	$("#mainholder").width($(window).width());
	
	centerimage = function()
	{
		var left = ( $(window).width() - $("#mainimage").width() ) / 2;
		$("#mainimage").css({"left" : left + "px"});
	};
	
	centerimage();
	
	 $("#mainimage").on("load",centerimage);
	
	$(window).bind('mousewheel DOMMouseScroll', function(event){
	    if (event.originalEvent.wheelDelta > 0 || event.originalEvent.detail < 0) {
	        // scroll up
	    	console.log('scrolling up !');
	        var w = $("#mainimage").width(); 
	    	$("#mainimage").width(w+zoom);
	    	var left = 	$("#mainimage").position().left - zoom/2;
	    	$("#mainimage").css({"left" : left + "px"});
	    	return false;
	    }
	    else {
	        // scroll down
	    	console.log('scrolling down !');
	        var w = $("#mainimage").width(); 
	    	$("#mainimage").width(w-zoom);
	    	var left = 	$("#mainimage").position().left + zoom/2;
	    	$("#mainimage").css({"left" : left + "px"});
	    	return false;
	    }
	});
	
	var clickspot;
	var imageposition;
	
	$("#mainimage").on("mousedown", function(event)
	{
		clickspot = event;
		imageposition = $("#mainimage").position();
		console.log(event);
		return false;
	});
	
	$("#mainimage").on("mouseup", function(event)
	{
		clickspot = false;
		return false;
	});
	
	$("#mainimage").on("mousemove", function(event)
	{
		//if( isMouseDown() )
		if( clickspot )
		{
			var changetop = clickspot.pageY - event.pageY;
			var changeleft = clickspot.pageX - event.pageX;
			
			var left = imageposition.left - changeleft;
			var top = imageposition.top - changetop;
			
			$(this).css({"left" : left + "px", "top" : top + "px"});
		}	
	});		
	
	
});
		
</script>