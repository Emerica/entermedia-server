

#set( $catalog = $context.getRequestParameter('uploadcatalog') )
#set( $sourcepath = "users/$!{user.userName}/" )
<form id="uploadform" name="wizard" method="post" enctype="multipart/form-data"
	action="$home/${applicationid}/components/upload/types/simple/finish.html?sourcepath=$sourcepath">
	<input type="hidden" name="categoryid" value="index"/>
    <div id="single-uploader" style="width:320px; margin: 20px auto;">

	<h3>[[Upload]]</h3> 
	<div style="clear: both"></div>
         <div class="file_input_divX">
          <input type="file"  length="20" value="Browse" name="file.0"  />
        </div>
        <div id="uploadprogress"  > </div>
		<br/><br/>

		$context.putPageValue("searcher",$mediaarchive.getAssetSearcher() )	
		$context.putPageValue("view","")	
		$pages.include("/$applicationid/components/xml/detaileditor.html", $context)

		
        			
			<h4>[[Caption]]</h4> 
			<input type="hidden" name="field" value="caption"/>
			<input type="text" class="required" name="caption.value" style="width: 278px;" />

			<h4>[[Title]]</h4>
			<input type="hidden" name="field" value="assettitle"/>
			<input type="text" class="required" name="assettitle.value" style="width: 278px;" />
            
            
			<h4>[[Asset Type]]</h4>
			<input type="hidden" name="field" value="keywords"/>
			<input type="text" class="required" name="keywords.value" style="width: 278px;" />
			
			<div style="clear: both;"></div>

<div class="embutton" >
	<input class="btn small" style="float: right; margin-bottom: 20px; margin-right: 15px;" type="button" id="finishbutton" class="finishbutt" value="[[Submit]]" onclick="doUpload('uploadform');">
</div>
</div>
</form>


<script type="text/javascript" >
	var uploadid;
 	doUpload =  function()
 	{
 		if(jQuery("#uploadform").valid()) {
 	 		jQuery("#finishbutton").attr('disabled','disabled');
			jQuery("#uploadform").submit();
 		}
 	}
 	
 	getUploadId = function()
 	{
 		if( uploadid == undefined)
 		{
 			var d = new Date();
 			uploadid = "$user.getId()_" + d.getTime();
 		}
 		return uploadid;
 	}
 	
 	pickFile = function(filename)
 	{
 		jQuery("#uploadform #fileName").attr("value", filename );
 		var action = jQuery("#uploadform").attr("action");
 		jQuery("#uploadform").attr("action", action + "&uploadid=" + getUploadId() );
 	}
 	
 	checkProgress = function()
 	{
 		jQuery("#uploadprogress").load("$home$apphome/components/upload/types/simple/uploadprogress.html?uploadid="+ getUploadId());
 	}
 	
 	function showResponse(responseText, statusText, xhr, $form)  
 	{ 
 		//jQuery.fn.livequery.stopped = true;
 		//jQuery("#embody").html(responseText);	
 		//jQuery.fn.livequery.stopped = false;
		document.location.href = "$home$apphome/views/search/reports/runsavedsearch.html?queryid=01newlyuploaded&searchtype=asset&reporttype=01newlyuploaded";
 	}
 	
 	//special validator for file name
 	jQuery.validator.addMethod("filename",
 			function(value) {
 				var characterReg = /^\s*[a-zA-Z0-9\._,\s]+\s*$/;
 	   			return characterReg.test(value);
 			}, 
 			'Invalid file name.'
 	);
 	
    // wait for the DOM to be loaded 
    $(document).ready(function() { 
    	jQuery("#uploadform").validate({
    		rules: {
    			fileName: "filename"
    		}
    	});
    	
        // bind 'myForm' and provide a simple callback function 
        $('#uploadform').ajaxForm({ 
        	        // target identifies the element(s) to update with the server response 
        	       // target: '#emcontainer', 
        	        // success identifies the function to invoke when the server response 
        	        // has been received; here we apply a fade-in effect to the new content
        	        beforeSubmit:function() 
        	        { 
        	            checkProgress(); 
        	           // document.onclick = disable;
        	            jQuery("#finishbutton").attr("value","Sending...");
        	           
        	        }, 
        	        success: showResponse
        	        
        	    }); 
    }); 
 	
</script>
